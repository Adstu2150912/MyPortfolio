<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" xmlns:reports="http://typo3.org/ns/MaxServ/SiteReports/ViewHelpers" data-namespace-typo3-fluid="true">
	<script src="typo3/sysext/core/Resources/Public/JavaScript/Contrib/jquery/jquery-3.1.1.js">
	</script>
	<script src="typo3conf/ext/site_reports/Resources/Public/Javascripts/vendor/Chart.min.js" type="text/javascript">
	</script>
	<script src="typo3conf/ext/site_reports/Resources/Public/Javascripts/Charts.js" type="text/javascript">
	</script>
<div class="row">
	<div class="col-lg-12">
		<div class="ibox">
			<div class="ibox-content project-information">
				<div class="row">
					<div class="col-lg-12">
						<div class="m-b-md project-header">
							<f:link.action action="listProjects" class="btn btn-white btn-xs pull-right" id="linkOverviewPage">Terug naar klanten</f:link.action>
							<img src="{project.avatar}" height="48" width="48" class="pull-left img-circle" />
							<a href="https://jira.maxserv.com/projects/{project.key}"><h2>{project.name}</h2></a>
						</div>
						<f:link.action action="showPdf" arguments="{project: project}">showPdf</f:link.action>
						<f:link.action action="listPdf">listPdf</f:link.action>
						<dl class="dl-horizontal">
							<dt>{assocFields.5.name}</dt>
							<dd>
								<f:if condition="{assocFields.5.value} == 'Y'">
									<f:then>
										<span class="label label-primary">Actief</span>
									</f:then>
									<f:else>
										<span class="label label-danger">Inactief</span>
									</f:else>
								</f:if>
							</dd>
						</dl>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-5">
						<dl class="dl-horizontal">
							<dt>{assocFields.1.name}</dt> <dd>{assocFields.1.value}</dd>
							<dt>{assocFields.3.name}</dt> <dd>{assocFields.3.value} <f:if condition="{assocFields.6.value}"> uur per  {assocFields.6.value}</f:if></dd>
							<f:if condition="{assocFields.2.value}">
								<dt>Uurtarief</dt> <dd>&euro; <f:format.number decimals="2" decimalSeparator="," thousandsSeparator=".">{assocFields.2.value}</f:format.number></dd>
							</f:if>
							<dt>Open issues</dt> <dd>{project.numberOfOpenIssues}</dd>
						</dl>
					</div>
					<div class="col-lg-7" id="cluster_info">
						<dl class="dl-horizontal">
							<dt>Startdatum</dt> <dd>*startdatum*</dd>
							<dt>Einddatum</dt> <dd>*einddatum*</dd>
							<dt>Tribe</dt> <dd>{project.tribe.title} - {project.tribe.subname}</dd>
							<dt>CMS</dt> <dd>*CMS*</dd>
							<dt>Account Manager</dt> <dd>*Account Manager*</dd>
						</dl>
					</div>
					<div class="col-lg-9">
							<script>
                                var projectHours = <f:format.raw>{projectHours}</f:format.raw>;
                                var contractHours = <f:format.raw>{assocFields.3.value}</f:format.raw>;
                                var pieChartData = {
                                   	labels: <f:format.raw>{labelsPieChartJson}</f:format.raw>,
                                	datasets: [{
                                   	    backgroundColor: ['#000000','#E0E0E0'],
										data:[projectHours, (contractHours - projectHours)]
                                   	}],
                                };
							</script>
							<div class="flex-container" id="pieChartContainer">
								<div id="pieChartTitle">Totaal beschikbare uren</div>
								<div id="pieChart">
									<script>
                                    var projectHours = <f:format.raw>{projectHours}</f:format.raw>;
                                    var contractHours = <f:format.raw>{assocFields.3.value}</f:format.raw>;
                                    var hoursPercentage = parseInt(((projectHours / contractHours) * 100));
                                    document.write(hoursPercentage + "%");
									</script>
								</div>
								<canvas id="pie" class="pieChart" data-variable="pieChartData" height="150"></canvas>
							</div>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-12">
						<dl class="dl-horizontal">
							<dt>Uren deze maand:</dt>
							<dd>
								<div class="progress active m-b-sm">
									<div style="width: {percentage}%;" class="progress-bar {progressClass}"></div>
								</div>
								<small>Er zijn <strong>{projectHours}</strong> uren besteed<f:if condition="{assocFields.3.value}"> van de <strong>{assocFields.3.value}</strong> uren die beschikbaar zijn</f:if></small>
							</dd>
						</dl>
					</div>
				</div>

				<div class="row m-t-sm">
					<div class="col-lg-12">
						<div class="panel blank-panel">
							<div class="panel-heading">
								<div class="panel-options">
									<ul class="nav nav-tabs">
										<li class="report-tabs active"><a href="#tab-1" data-toggle="tab" aria-expanded="false">Uren report</a></li>
										<li class="report-tabs"><a href="#tab-2" data-toggle="tab" aria-expanded="true">Open issues</a></li>
										<li class="" id="tab-comments"><a href="#tab-3" data-toggle="tab" aria-expanded="true">Opmerkingen</a></li>
										<li class="report-tabs"><a href="#tab-4" data-toggle="tab" aria-expanded="true">Contactpersonen</a></li>
									</ul>
								</div>
							</div>

							<div class="panel-body">

								<div class="tab-content">
									<div class="tab-pane active" id="tab-1">
										<dl class="overviewLastYears">
											<f:format.raw>
												<f:if condition="{lastYears}">
													<f:then>
														<f:for each="{lastYears}" as="year" iteration="iterator">
															<f:if condition="{year} == {lastYears.2}">
																<f:then>
																	<dt><a href="#" id="{year}">{year}</a></dt>
																</f:then>
																<f:else>
																	<dt><a href="#" id="{year}">{year}</a></dt> -
																</f:else>
															</f:if>
														</f:for>
													</f:then>
												</f:if>
											</f:format.raw>
										</dl>
											<script src="typo3/sysext/core/Resources/Public/JavaScript/Contrib/jquery/jquery-3.1.1.js">
											</script>
											<script src="typo3conf/ext/site_reports/Resources/Public/Javascripts/vendor/Chart.min.js" type="text/javascript">
											</script>
											<script src="typo3conf/ext/site_reports/Resources/Public/Javascripts/Charts.js" type="text/javascript">
											</script>
												<script>
                                                var aYears = [];

                                                <f:for each="{lastYears}" as="year" iteration="iterator">
                                                    aYears.push({year});
                                                </f:for>

                                                aYears.reverse();

                                                function isClicked(){
                                                    return true;
                                                }

												jQuery(aYears).each(function (index, element) {
													jQuery(String("#" + element)).click(function () {
														switch(element){
															case aYears[0]:
																lineData = {
																	labels: <f:format.raw>{labelJson}</f:format.raw>,
																	datasets: <f:format.raw>{datasetLineChartJson}</f:format.raw>,
																};
																barData = {
																	labels: <f:format.raw>{labelJson}</f:format.raw>,
																	datasets: <f:format.raw>{datasetBarChartJson}</f:format.raw>,
																};

																jQuery.getScript("typo3conf/ext/site_reports/Resources/Public/Javascripts/Charts.js", function(){});
																break;

															case aYears[1]:
																lineData = {
																	labels: <f:format.raw>{labelLastYearJson}</f:format.raw>,
																	datasets: <f:format.raw>{dataSetLineChartLastYearJson}</f:format.raw>,
																};
																barData = {
																	labels: <f:format.raw>{labelLastYearJson}</f:format.raw>,
																	datasets: <f:format.raw>{dataSetBarChartLastYearJson}</f:format.raw>,
																};

																jQuery.getScript("typo3conf/ext/site_reports/Resources/Public/Javascripts/Charts.js", function(){});
																break;

															case aYears[2]:
																lineData = {
																	labels: <f:format.raw>{labelBeforeLastYearJson}</f:format.raw>,
																	datasets: <f:format.raw>{dataSetLineChartBeforeLastYearJson}</f:format.raw>,
																};

																barData = {
																	labels: <f:format.raw>{labelBeforeLastYearJson}</f:format.raw>,
																	datasets: <f:format.raw>{dataSetBarChartBeforeLastYearJson}</f:format.raw>,
																};

																jQuery.getScript("typo3conf/ext/site_reports/Resources/Public/Javascripts/Charts.js", function(){});
																break;
															}
														});
														var notClicked = jQuery(String("#" + element)).click(function(){isClicked()});
														if(notClicked != true ||  notClicked == null){
															lineData = {
																labels: <f:format.raw>{labelJson}</f:format.raw>,
																datasets: <f:format.raw>{datasetLineChartJson}</f:format.raw>,
															};

                                                            barData = {
                                                                labels: <f:format.raw>{labelJson}</f:format.raw>,
																datasets: <f:format.raw>{datasetBarChartJson}</f:format.raw>,
															};
														}
													});
											</script>
										<canvas id="bar1" class="linechart" data-variable="lineData" height="100"></canvas>
										<br>
										<br>
										<canvas id="bar2" class="bar" data-variable="barData" height="100"></canvas>
									</div>
									<div class="tab-pane" id="tab-2">
										<table class="table table-hover">
											<thead>
											<tr>
												<th>Key</th>
												<th>Gemeld op</th>
												<th>Onderwerp</th>
												<th>Toegewezen aan</th>
												<th>Status</th>
												<th>Sprint</th>
												<th>Uren</th>
											</tr>
											</thead>
											<tbody>
											<f:for each="{openIssues}" as="issue" iteration="iterator">
												<tr>
													<td><reports:jiraIssueLink issueKey="{issue.key}" baseUrl="{settings.jira.issueLink}" target="_blank">{issue.key}</reports:jiraIssueLink> <i class="fa fa-external-link"></i></td>
													<td><f:format.date format="d-m-Y">{issue.fields.created}</f:format.date></td>
													<td>{issue.fields.summary}</td>
													<td>{issue.fields.assignee.displayName}</td>
													<td>{issue.fields.status.name}</td>
													<td></td>
													<td>
														<script>
															var logHours = (<f:format.raw>{issue.fields.timespent}</f:format.raw> / 3600);
															document.write(Number(logHours).toFixed(1));
														</script>
													</td>
												</tr>
											</f:for>
											</tbody>
										</table>
									</div>
									<div class="tab-pane" id="tab-3">
										<table class="table table-hover">
											<thead>
											<tr>
												<th>Gemeld op</th>
												<th>Opmerking</th>
											</tr>
											</thead>
											<tbody>
											<f:for each="{assocComments}" as="comment" iteration="iterator">
												<f:if condition="{comment.project} == {project.key}">
													<f:then><tr><td><f:format.date format="d-m-Y">{comment.tstamp}</f:format.date></td><td>{comment.comment}</td></tr>
													</f:then>
												</f:if>
											</f:for>
											</tbody>
										</table>
									</div>
									<div class="tab-pane" id="tab-4">
										<table class="table table-hover">
											<thead>
											<tr>
												<th>Naam</th>
												<th>Email</th>
												<th>Telefoon</th>
												<th>Functie</th>
											</tr>
											</thead>
											<tbody>
											<f:for each="{assocContacts}" as="contact" iteration="iterator">
												<f:if condition="{contact.project} == {project.key}">
													<f:then> <tr><td>{contact.name}</td><td>{contact.email}</td><td>{contact.phone_number}</td><td>{contact.role}</td></tr>
													</f:then>
												</f:if>
											</f:for>
											</tbody>
										</table>

									</div>
								</div>

							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<f:section name="field">
	<dt>{field.name}</dt> <dd>{field.value}</dd>
</f:section>
</html>